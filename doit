#!/bin/bash
WORKDIR=$HOME/.doit
while getopts ":h" opt; do
  case ${opt} in
    h )
      echo "Usage:"
      echo "    doit add <todo>                      Adds things to do to  a list with an ID."
      echo "    doit list                            Lists all things to do."
      echo "    doit complete <id>                   Removes the note with the specified ID from the list."
      exit 0
      ;;
   \? )
     echo "Invalid Option: -$OPTARG" 1>&2
     exit 1
     ;;
  esac
done
shift $((OPTIND -1))

WORKDIR=$HOME/.doit
if [ ! -d "$WORKDIR" ]; then
  mkdir $WORKDIR
fi

NOTEFILE=$WORKDIR/notes.txt
if [ ! -f $NOTEFILE ]; then
    touch $NOTEFILE
fi

subcommand=$1; shift  # Remove 'pip' from the argument list
case "$subcommand" in
  # Parse options to the install sub command
  add)
    COUNT=$WORKDIR/count.txt
    if [ ! -f $COUNT ]; then
      echo "0" > $COUNT
    fi

    read -r current_count < $COUNT
    next_count=$((current_count + 1))
    echo "$next_count" > $COUNT

    echo "$next_count $1" >> $NOTEFILE
    echo "doit: $1"; shift  # Remove 'install' from the argument list
    # Process package options
    # while getopts ":t:" opt; do
    #   case ${opt} in
    #     t )
    #       target=$OPTARG
    #       ;;
    #     \? )
    #       echo "Invalid Option: -$OPTARG" 1>&2
    #       exit 1
    #       ;;
    #     : )
    #       echo "Invalid Option: -$OPTARG requires an argument" 1>&2
    #       exit 1
    #       ;;
    #   esac
    # done
    # shift $((OPTIND -1))
    ;;
  list)
    echo "doit"
    echo "===="
    cat $NOTEFILE
    ;;
  complete)
    echo "completing line with: $1"
    AFTER_REMOVE=`sed "/^$1/ d" < $NOTEFILE`
    echo $AFTER_REMOVE > $NOTEFILE
    ;;
esac
